<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Formulario DASS-21</title>
    <link rel="stylesheet" href="css/expediente.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/ico/logo_pequeno.ico">
    <style>

    </style>
</head>

<body>

    <div class="container-fluid">
        <div class="row h-100">

            <!-- Sidebar -->
            <div class="col-md-2 sidebar d-flex flex-column p-3">
                <h4 class="text-center">Men√∫</h4>
                <a id="linkPerfil" href="#"><i class="bi bi-person-circle me-2"></i> Perfil</a>
                <a id="linkDatos" href="#"><i class="bi bi-clipboard-data me-2"></i> Datos F√≠sicos</a>
                <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-heart-pulse me-2"></i> Formularios
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" id="linkDass" href="#">DASS-21</a></li>
                        <li><a class="dropdown-item" id="linkEstilo" href="#">Estilo de Vida</a></li>
                    </ul>
                </div>
                <a id="linkHistorial" href="#"><i class="bi bi-house-heart-fill me-2"></i> Historial Patol√≥gico</a>
                <a href="ListadoAlumnos.html"><i class="bi bi-box-arrow-left me-2"></i> Salir</a>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 p-4">
                <div class="nav d-flex justify-content-between align-items-center mb-4">
                    <img src="/images/logo_unacar (1).png" alt="logo" class="unacar">
                    <h2>Perfil del Alumno</h2>
                    <button class="btn btn-primary" disabled></button>
                </div>

                <!-- Datos del alumno -->
                <div class="card card-custom mb-4">
                    <div class="card-body d-flex">
                        <div class="left-section">
                            <img src="/imagenes/usuario.png" alt="Foto Alumno" class="profile-img mb-3">
                        </div>
                        <div class="right-section">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Nombre:</span>
                                        <input type="text" class="form-control" id="nombre" name="nombre" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Edad:</span>
                                        <input type="text" class="form-control" id="edad" name="edad" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Sexo:</span>
                                        <input type="text" class="form-control" id="sexo" name="sexo" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Matr√≠cula:</span>
                                        <input type="text" class="form-control" id="matricula" name="matricula"
                                            disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Carrera:</span>
                                        <input type="text" class="form-control" name="carrera" id="carrera" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Facultad:</span>
                                        <input type="text" class="form-control" name="facultad" id="facultad" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Correo Electr√≥nico:</span>
                                        <input type="email" class="form-control" name="email" id="email" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                
                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <h5 class="text-center">Resultados de Ansiedad</h5>
                                <tr>
                                    <th scope="col">Pregunta 1</th>
                                    <th scope="col">Pregunta 4</th>
                                    <th scope="col">Pregunta 7</th>
                                    <th scope="col">Pregunta 9</th>
                                    <th scope="col">Pregunta 15</th>
                                    <th scope="col">Pregunta 19</th>
                                    <th scope="col">Pregunta 20</th>
                                    <th scope="col">Severidad</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-primary">
                                    <td id="p2"></td>
                                    <td id="p4"></td>
                                    <td id="p7"></td>
                                    <td id="p9"></td>
                                    <td id="p15"></td>
                                    <td id="p19"></td>
                                    <td id="p20"></td>
                                    <td id="severidad_ansiedad"></td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <h5 class="text-center">Resultados de Depresi√≥n</h5>
                                <tr>
                                    <th scope="col">Pregunta 3</th>
                                    <th scope="col">Pregunta 5</th>
                                    <th scope="col">Pregunta 10</th>
                                    <th scope="col">Pregunta 13</th>
                                    <th scope="col">Pregunta 16</th>
                                    <th scope="col">Pregunta 17</th>
                                    <th scope="col">Pregunta 21</th>
                                    <th scope="col">Severidad</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-primary">
                                    <td id="p3"></td>
                                    <td id="p5"></td>
                                    <td id="p10"></td>
                                    <td id="p13"></td>
                                    <td id="p16"></td>
                                    <td id="p17"></td>
                                    <td id="p21"></td>
                                    <td id="severidad_depresion"></td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <h5 class="text-center">Resultados de Estr√©s</h5>
                                <tr>
                                    <th scope="col">Pregunta 1</th>
                                    <th scope="col">Pregunta 6</th>
                                    <th scope="col">Pregunta 8</th>
                                    <th scope="col">Pregunta 11</th>
                                    <th scope="col">Pregunta 12</th>
                                    <th scope="col">Pregunta 14</th>
                                    <th scope="col">Pregunta 18</th>
                                    <th scope="col">Severidad</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-primary">
                                    <td id="p1"></td>
                                    <td id="p6"></td>
                                    <td id="p8"></td>
                                    <td id="p11"></td>
                                    <td id="p12"></td>
                                    <td id="p14"></td>
                                    <td id="p18"></td>
                                    <td id="severidad_estres"></td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <h5 class="text-center">Resultados Generales</h5>
                                <tr>
                                    <th scope="col">Total Ansiedad</th>
                                    <th scope="col">Total Depresi√≥n</th>
                                    <th scope="col">Total Estr√©s</th>
                                    <th scope="col">Total General</th>
                                    
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-primary">
                                    <td id="total_ansiedad"></td>
                                    <td id="total_depresion"></td>
                                    <td id="total_estres"></td>
                                    <td id="total_general"></td>
                                    
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>


            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener la matr√≠cula desde la URL
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
                const enlacePuntajes = document.getElementById("enlacePuntajes");
                enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
            }
        });
        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                const linkHistorial = document.getElementById("linkHistorial");
                linkHistorial.href = `HistorialPatologicoAlum.html?matricula_alum=${matricula}`;
            }
        });

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener la matr√≠cula desde la URL
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
                const enlacePuntajes = document.getElementById("enlacePuntajes");
                enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                const linkPerfil = document.getElementById("linkPerfil");
                linkPerfil.href = `expediente.html?matricula_alum=${matricula}`;
            }
        });

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener la matr√≠cula desde la URL
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
                const enlacePuntajes = document.getElementById("enlacePuntajes");
                enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                const linkDatos = document.getElementById("linkDatos");
                linkDatos.href = `datosfisicosalumnos.html?matricula_alum=${matricula}`;
            }
        });

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener la matr√≠cula desde la URL
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
                const enlacePuntajes = document.getElementById("enlacePuntajes");
                enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                const linkDass = document.getElementById("linkDass");
                linkDass.href = `formulariodass.html?matricula_alum=${matricula}`;
            }
        });

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener la matr√≠cula desde la URL
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
                const enlacePuntajes = document.getElementById("enlacePuntajes");
                enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                const linkEstilo = document.getElementById("linkEstilo");
                linkEstilo.href = `formularioestilo.html?matricula_alum=${matricula}`;
            }
        });

    </script>



    <script>
        function cargarPerfil() {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (!matricula) {
                alert("No se proporcion√≥ una matr√≠cula.");
                return;
            }

            fetch(`perfil.php?matricula_alum=${matricula}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }
                    // Verificar historial
                    fetch(`historial.php?matricula_alum=${matricula}`)
                        .then(res => res.json())
                        .then(historial => {
                            const historialVacio = !historial || Object.keys(historial).length === 0;

                            // Verificar si hay datos f√≠sicos cargados
                            const tieneDatosFisicos = data.fechas && data.fechas.length > 0;

                            verificarEstadoExpediente(data, historialVacio, tieneDatosFisicos);
                        });


                    // document.getElementById("fotoAlumno").src = data.foto;
                    document.getElementById("matricula").value = data.matricula_alum;
                    document.getElementById("nombre").value = data.nombres_alum + " " + data.ape_paterno_alum + " " + data.ape_materno_alum;
                    document.getElementById("sexo").value = data.sexo;
                    document.getElementById("edad").value = data.edad_alum;
                    document.getElementById("facultad").value = data.nombre_facultad;
                    document.getElementById("carrera").value = data.nombre_carrera;
                    document.getElementById("email").value = data.correo_alum;

                })
                .catch(error => console.error("Error al cargar el perfil:", error));
            // Cargar el historial cl√≠nico
            cargarHistorialClinico(matricula);


        }

        document.addEventListener("DOMContentLoaded", cargarPerfil);

        function cargarDatosFisicosRecientes(matricula) {
            fetch(`datosdass.php?matricula_alum=${matricula}`)
                .then(response => response.json())
                .then(datos => {
                    document.getElementById("p2").textContent = datos.p2 || "0";
                    document.getElementById("p4").textContent = datos.p4 || "0";
                    document.getElementById("p7").textContent = datos.p7 || "0";
                    document.getElementById("p9").textContent = datos.p9 || "0";
                    document.getElementById("p15").textContent = datos.p15 || "0";
                    document.getElementById("p19").textContent = datos.p19 || "0";
                    document.getElementById("p20").textContent = datos.p20 || "0";
                    document.getElementById("severidad_ansiedad").textContent = datos.severidad_ansiedad || "0";

                    document.getElementById("p3").textContent = datos.p3 || "0";
                    document.getElementById("p5").textContent = datos.p5 || "0";
                    document.getElementById("p10").textContent = datos.p10 || "0";
                    document.getElementById("p13").textContent = datos.p13 || "0";
                    document.getElementById("p16").textContent = datos.p16 || "0";
                    document.getElementById("p17").textContent = datos.p17 || "0";
                    document.getElementById("p21").textContent = datos.p21 || "0";
                    document.getElementById("severidad_depresion").textContent = datos.severidad_depresion || "0";

                    document.getElementById("p1").textContent = datos.p1 || "0";
                    document.getElementById("p6").textContent = datos.p6 || "0";
                    document.getElementById("p8").textContent = datos.p8 || "0";
                    document.getElementById("p11").textContent = datos.p11 || "0";
                    document.getElementById("p12").textContent = datos.p12 || "0";
                    document.getElementById("p14").textContent = datos.p14 || "0";
                    document.getElementById("p18").textContent = datos.p18 || "0";
                    document.getElementById("severidad_estres").textContent = datos.severidad_estres || "0";

                    document.getElementById("total_ansiedad").textContent = datos.total_ansiedad || "0";
                    document.getElementById("total_depresion").textContent = datos.total_depresion || "0";
                    document.getElementById("total_estres").textContent = datos.total_estres || "0";
                    document.getElementById("total_general").textContent = datos.total_general || "0";
                })
                .catch(error => console.error("Error al cargar los datos f√≠sicos:", error));
        }


        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                cargarDatosFisicosRecientes(matricula);
            }
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener botones
            const btnFormularios = document.querySelector(".btn-formularios");
            const btnHistorial = document.querySelector(".btn-historial");
            const btnDatosFisicos = document.querySelector(".btn-datos-fisicos");

            // Obtener cuadros y t√≠tulo
            const tituloFormulario = document.getElementById("titulo-formulario");
            const tituloSeccion = document.getElementById("titulo-seccion");
            const formularioCuadros = document.getElementById("formulario-cuadros");
            const historialCuadro = document.getElementById("historial-cuadro");
            const datosFisicosCuadro = document.getElementById("datos-fisicos-cuadro");

            // Funci√≥n para actualizar el t√≠tulo y mostrar contenido
            function mostrarSeccion(titulo, mostrarFormulario, mostrarHistorial, mostrarDatosFisicos) {
                // Cambiar el texto del t√≠tulo
                tituloSeccion.innerText = titulo;
                // Mostrar el t√≠tulo
                tituloFormulario.classList.remove("d-none");

                // Controla la visibilidad de los cuadros
                formularioCuadros.classList.toggle("d-none", !mostrarFormulario);
                historialCuadro.classList.toggle("d-none", !mostrarHistorial);
                datosFisicosCuadro.classList.toggle("d-none", !mostrarDatosFisicos);
            }

            // Al cargar la p√°gina, ocultamos todas las secciones (excepto el t√≠tulo)
            formularioCuadros.classList.add("d-none");
            historialCuadro.classList.add("d-none");
            datosFisicosCuadro.classList.add("d-none");

            // Evento para mostrar Formularios
            btnFormularios.addEventListener("click", function () {
                mostrarSeccion("Formularios", true, false, false);
            });

            // Evento para mostrar Historial Cl√≠nico
            btnHistorial.addEventListener("click", function () {
                mostrarSeccion("Historial Heredo-Familiar", false, true, false);
            });

            // Evento para mostrar Datos F√≠sicos
            btnDatosFisicos.addEventListener("click", function () {
                mostrarSeccion("Datos F√≠sicos", false, false, true);
            });
        });


        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (!matricula) return;

            Promise.all([
                fetch(`perfil.php?matricula_alum=${matricula}`).then(r => r.json()),
                fetch(`historial.php?matricula_alum=${matricula}`).then(r => r.json())
            ])
                .then(([perfil, historial]) => {
                    // ‚öôÔ∏è Datos f√≠sicos ya vienen desde perfil.php
                    const tieneDatosFisicos = perfil.fechas && perfil.fechas.length > 0;
                    const historialVacio = Object.keys(historial).length === 0;

                    // üß† Mostrar modal informativo
                    mostrarModalEstado(perfil, tieneDatosFisicos, historialVacio);
                });
        });

    </script>

    <!-- Modal de estado de expediente -->
    <div class="modal fade" id="modalEstadoExpediente" tabindex="-1" aria-labelledby="modalEstadoExpedienteLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-info">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalEstadoExpedienteLabel">Estado del Expediente</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                </div>
                <div class="modal-body" id="contenido-estado-expediente">
                    <!-- Este contenido se llena por JS -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info" data-bs-dismiss="modal">Entendido</button>
                </div>
            </div>
        </div>
    </div>



</body>

</html>