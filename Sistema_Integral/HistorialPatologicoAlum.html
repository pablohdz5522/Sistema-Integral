<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Historial Patologico Alumnado</title>
  <link rel="stylesheet" href="css/expediente.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="/ico/logo_pequeno.ico">
  <style>

  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row h-100">

    <!-- Sidebar -->
    <div class="col-md-2 sidebar d-flex flex-column p-3">
      <h4 class="text-center">Men칰</h4>
      <a id="linkPerfil" href="#"><i class="bi bi-person-circle me-2"></i> Perfil</a>
      <a id="linkDatos" href="#"><i class="bi bi-clipboard-data me-2"></i> Datos F칤sicos</a>
      <div class="dropdown">
          <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-heart-pulse me-2"></i> Formularios
          </a>
          <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">DASS-21</a></li>
              <li><a class="dropdown-item" href="#">Estilo de Vida</a></li>
          </ul>
      </div>
      <a id="linkHistorial" href="#"><i class="bi bi-house-heart-fill me-2"></i> Historial Patol칩gico</a>
      <a href="ListadoAlumnos.html"><i class="bi bi-box-arrow-left me-2"></i> Salir</a>
    </div>
  
    <!-- Main Content -->
    <div class="col-md-10 p-4">
      <div class="nav d-flex justify-content-between align-items-center mb-4">
        <img src="/images/logo_unacar (1).png" alt="logo" class="unacar">
        <h2 class="text-center">Historial Patologicos</h2>  
      </div>

      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          Informaci칩n del Alumno
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">Matr칤cula</label>
              <input type="text" class="form-control" id="matricula" disabled>
            </div>
            <div class="col-md-3">
              <label class="form-label">Nombre</label>
              <input type="text" class="form-control" id="nombre" disabled>
            </div>
            <div class="col-md-2">
              <label class="form-label">Sexo</label>
              <input type="text" class="form-control" id="sexo" disabled>
            </div>
            <div class="col-md-2">
              <label class="form-label">Edad</label>
              <input type="text" class="form-control" id="edad" disabled>
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header bg-success text-white">
          Historial Patol칩gico Familiar
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Sobrepeso/Obesidad</label>
              <input type="text" class="form-control" id="sobrepeso" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Diabetes Mellitus</label>
              <input type="text" class="form-control" id="diabetes" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Hipertensi칩n Arterial</label>
              <input type="text" class="form-control" id="hipertension" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Triglic칠ridos Altos</label>
              <input type="text" class="form-control" id="trigliceridos" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Colesterol Alto</label>
              <input type="text" class="form-control" id="colesterol" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Hepatitis</label>
              <input type="text" class="form-control" id="hepatitis" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">H칤gado Graso</label>
              <input type="text" class="form-control" id="higado" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Cardiopat칤as</label>
              <input type="text" class="form-control" id="cardiopatias" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Nefropat칤as</label>
              <input type="text" class="form-control" id="nefropatias" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Estre침imiento</label>
              <input type="text" class="form-control" id="estre침imiento" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Gastritis</label>
              <input type="text" class="form-control" id="gastritis" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">C치ncer</label>
              <input type="text" class="form-control" id="cancer" disabled>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
          Historial Patol칩gico Personal
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">쯊ienes alguna enfermedad?</label>
              <input type="text" class="form-control" id="tienesEnfermedad" disabled>
            </div>
            <div class="col-md-6">
              <label class="form-label">Tratamiento</label>
              <input type="text" class="form-control" id="Tratamiendo" disabled>
            </div>
          </div>
        </div>
      </div>
      

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener la matr칤cula desde la URL
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (matricula) {
            // Actualizar el enlace de "Estilo de Vida" con la matr칤cula
            const enlacePuntajes = document.getElementById("enlacePuntajes");
            enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
        }
    });

    document.addEventListener("DOMContentLoaded", function() {
    const params = new URLSearchParams(window.location.search);
    const matricula = params.get("matricula_alum");

    if (matricula) {
        const linkPerfil = document.getElementById("linkPerfil");
        linkPerfil.href = `expediente.html?matricula_alum=${matricula}`;
    }
});

</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener la matr칤cula desde la URL
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (matricula) {
            // Actualizar el enlace de "Estilo de Vida" con la matr칤cula
            const enlacePuntajes = document.getElementById("enlacePuntajes");
            enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
        }
    });
    document.addEventListener("DOMContentLoaded", function() {
    const params = new URLSearchParams(window.location.search);
    const matricula = params.get("matricula_alum");

    if (matricula) {
        const linkHistorial = document.getElementById("linkHistorial");
        linkHistorial.href = `HistorialPatologicoAlum.html?matricula_alum=${matricula}`;
    }
});

</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener la matr칤cula desde la URL
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (matricula) {
            // Actualizar el enlace de "Estilo de Vida" con la matr칤cula
            const enlacePuntajes = document.getElementById("enlacePuntajes");
            enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
        }
    });

    document.addEventListener("DOMContentLoaded", function() {
    const params = new URLSearchParams(window.location.search);
    const matricula = params.get("matricula_alum");

    if (matricula) {
        const linkDatos = document.getElementById("linkDatos");
        linkDatos.href = `datosfisicosalumnos.html?matricula_alum=${matricula}`;
    }
});

</script>

<script>
    function cargarHistorialClinico(matricula) {
        fetch(`historial.php?matricula_alum=${matricula}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }

                // Llenar los campos del historial cl칤nico
                document.getElementById("sobrepeso").value = data.sobrepeso;
                document.getElementById("diabetes").value = data.diabetes;
                document.getElementById("hipertension").value = data.hipertension;
                document.getElementById("trigliceridos").value = data.trigliceridos;
                document.getElementById("colesterol").value = data.colesterol;
                document.getElementById("hepatitis").value = data.hepatitis;
                document.getElementById("higado").value = data.higado_graso;
                document.getElementById("cardiopatias").value = data.cardiopatias;
                document.getElementById("nefropatias").value = data.nefropatias;
                document.getElementById("estre침imiento").value = data.estre침imiento;
                document.getElementById("gastritis").value = data.gastritis;
                document.getElementById("cancer").value = data.cancer;
                document.getElementById("tienesEnfermedad").value = data.otros;
                document.getElementById("Tratamiendo").value = data.tratamiento;
            })
            .catch(error => console.error("Error al cargar el historial cl칤nico:", error));
    }

    function cargarPerfil() {
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (!matricula) {
            alert("No se proporcion칩 una matr칤cula.");
            return;
        }

        fetch(`perfil.php?matricula_alum=${matricula}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }

               // document.getElementById("fotoAlumno").src = data.foto;
                document.getElementById("matricula").value = data.matricula_alum;
                document.getElementById("nombre").value = data.nombres_alum + " " + data.ape_paterno_alum + " " + data.ape_materno_alum;
                document.getElementById("sexo").value = data.sexo;
                document.getElementById("edad").value = data.edad_alum;
                document.getElementById("facultad").value = data.nombre_facultad;
                document.getElementById("carrera").value = data.nombre_carrera;
                document.getElementById("email").value = data.correo_alum;

                // 游릭 Estado del formulario Apgar
                const statusRectangleApgar = document.getElementById('status-rectangle-apgar');
                const statusTextApgar = document.getElementById('status-text-apgar');
                if (data.estilo_vida_realizado) {
                    statusTextApgar.textContent = 'Ya realizado';
                    statusRectangleApgar.classList.add('bg-success'); // Color verde
                } else {
                    statusTextApgar.textContent = 'No lo ha realizado';
                    statusRectangleApgar.classList.add('bg-danger'); // Color rojo
                }

                // 游릭 Estado del formulario Sisco
                const statusRectangleSisco = document.getElementById('status-rectangle-sisco');
                const statusTextSisco = document.getElementById('status-text-sisco');
                if (data.sisco_realizado) {
                    statusTextSisco.textContent = 'Ya realizado';
                    statusRectangleSisco.classList.add('bg-success');
                } else {
                    statusTextSisco.textContent = 'No lo ha realizado';
                    statusRectangleSisco.classList.add('bg-danger');
                }
                })
                .catch(error => console.error("Error al cargar el perfil:", error));
                    // Cargar el historial cl칤nico
                 cargarHistorialClinico(matricula);

                
        }

        document.addEventListener("DOMContentLoaded", cargarPerfil);

        function cargarDatosFisicosRecientes(matricula) {
    fetch(`perfil.php?matricula_alum=${matricula}`)
        .then(response => response.json())
        .then(data => {
            if (data.fechas && data.fechas.length > 0) {
                const ultimaFecha = data.fechas[data.fechas.length - 1];
                document.getElementById("fecha-datos-fisicos").textContent = ultimaFecha;

                fetch(`datos_fisicos_detalle.php?matricula_alum=${matricula}&fecha=${ultimaFecha}`)
                    .then(response => response.json())
                    .then(datos => {
                        document.getElementById("peso").textContent = datos.peso || "-";
                        document.getElementById("modal-talla").textContent = datos.talla || "-";
                        document.getElementById("modal-imc").textContent = datos.imc || "-";
                        document.getElementById("modal-clasificacion_imc").textContent = datos.clasificacion_imc || "-";
                        document.getElementById("modal-glucosa").textContent = datos.glucosa || "-";
                        document.getElementById("modal-colesterol").textContent = datos.colesterol || "-";
                        document.getElementById("modal-trigliceridos").textContent = datos.trigliceridos || "-";
                        document.getElementById("modal-tension_arterial").textContent = datos.tension_arterial || "-";
                    })
                    .catch(error => console.error("Error al cargar los datos f칤sicos:", error));
            } else {
                document.getElementById("fecha-datos-fisicos").textContent = "Sin datos";
            }
        })
        .catch(error => console.error("Error al cargar fechas:", error));
}
    

    document.addEventListener("DOMContentLoaded", function() {
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (matricula) {
        cargarDatosFisicosRecientes(matricula);
    }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener botones
        const btnFormularios = document.querySelector(".btn-formularios");
        const btnHistorial = document.querySelector(".btn-historial");
        const btnDatosFisicos = document.querySelector(".btn-datos-fisicos");
    
        // Obtener cuadros y t칤tulo
        const tituloFormulario = document.getElementById("titulo-formulario");
        const tituloSeccion = document.getElementById("titulo-seccion");
        const formularioCuadros = document.getElementById("formulario-cuadros");
        const historialCuadro = document.getElementById("historial-cuadro");
        const datosFisicosCuadro = document.getElementById("datos-fisicos-cuadro");
    
        // Funci칩n para actualizar el t칤tulo y mostrar contenido
        function mostrarSeccion(titulo, mostrarFormulario, mostrarHistorial, mostrarDatosFisicos) {
            // Cambiar el texto del t칤tulo
            tituloSeccion.innerText = titulo;
            // Mostrar el t칤tulo
            tituloFormulario.classList.remove("d-none");
    
            // Controla la visibilidad de los cuadros
            formularioCuadros.classList.toggle("d-none", !mostrarFormulario);
            historialCuadro.classList.toggle("d-none", !mostrarHistorial);
            datosFisicosCuadro.classList.toggle("d-none", !mostrarDatosFisicos);
        }
    
        // Al cargar la p치gina, ocultamos todas las secciones (excepto el t칤tulo)
        formularioCuadros.classList.add("d-none");
        historialCuadro.classList.add("d-none");
        datosFisicosCuadro.classList.add("d-none");
    
        // Evento para mostrar Formularios
        btnFormularios.addEventListener("click", function() {
            mostrarSeccion("Formularios", true, false, false);
        });
    
        // Evento para mostrar Historial Cl칤nico
        btnHistorial.addEventListener("click", function() {
            mostrarSeccion("Historial Heredo-Familiar", false, true, false);
        });
    
        // Evento para mostrar Datos F칤sicos
        btnDatosFisicos.addEventListener("click", function() {
            mostrarSeccion("Datos F칤sicos", false, false, true);
        });
    });
</script>

</body>
</html>