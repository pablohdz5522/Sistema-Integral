<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Perfil Alumno</title>
  <link rel="stylesheet" href="css/expediente.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="/ico/logo_pequeno.ico">
  <style>

  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row h-100">

    <!-- Sidebar -->
    <div class="col-md-2 sidebar d-flex flex-column p-3">
      <h4 class="text-center">Men√∫</h4>
      <a id="linkPerfil" href="#"><i class="bi bi-person-circle me-2"></i> Perfil</a>
      <a id="linkDatos" href="#"><i class="bi bi-clipboard-data me-2"></i> Datos F√≠sicos</a>
      <div class="dropdown">
          <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-heart-pulse me-2"></i> Formularios
          </a>
          <ul class="dropdown-menu">
              <li><a class="dropdown-item" id="linkDass" href="#">DASS-21</a></li>
              <li><a class="dropdown-item" id="linkEstilo" href="#">Estilo de Vida</a></li>
          </ul>
      </div>
      <a id="linkHistorial" href="#"><i class="bi bi-house-heart-fill me-2"></i> Historial Patol√≥gico</a>
      <a href="ListadoAlumnos.html"><i class="bi bi-box-arrow-left me-2"></i> Salir</a>
  </div>

    <!-- Main Content -->
    <div class="col-md-10 p-4">
      <div class="nav d-flex justify-content-between align-items-center mb-4">
        <img src="/images/logo_unacar (1).png" alt="logo" class="unacar">
        <h2>Perfil del Alumno</h2>
        <button class="btn btn-primary" disabled></button>
      </div>

       <!-- Datos del alumno -->
  <div class="card card-custom mb-4">
    <div class="card-body d-flex">
      <div class="left-section">
        <img src="/imagenes/usuario.png" alt="Foto Alumno" class="profile-img mb-3">
      </div>
      <div class="right-section">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text">Nombre:</span>
              <input type="text" class="form-control" id="nombre" name="nombre" disabled>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text">Edad:</span>
              <input type="text" class="form-control" id="edad" name="edad" disabled>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text">Sexo:</span>
              <input type="text" class="form-control" id="sexo" name="sexo" disabled>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text">Matr√≠cula:</span>
              <input type="text" class="form-control" id="matricula" name="matricula" disabled>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text">Carrera:</span>
              <input type="text" class="form-control" name="carrera" id="carrera" disabled>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text">Facultad:</span>
              <input type="text" class="form-control" name="facultad" id="facultad" disabled>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text">Correo Electr√≥nico:</span>
              <input type="email" class="form-control" name="email" id="email" disabled>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

      <!-- Signos vitales / otros datos -->
      <div class="card card-custom mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
                <h5>Datos F√≠sicos</h5>
                <div><h5>Fecha: </h5> <span id="fecha-datos-fisicos"></span></div>
            </div>
            
            
          
          <div class="row g-3 mt-3">
            <div class="col-md-2">
              <div><i class="bi bi-person-fill-up"></i> Talla: <span id="modal-talla">-</span> cm</div>
            </div>
            <div class="col-md-2">
              <div><i class="bi bi-bar-chart-fill"></i>Peso: <span id="peso">-</span> kg</div>
            </div>
            <div class="col-md-2">
              <div><i class="bi bi-calculator"></i> IMC: <span id="modal-imc">-</span></div>
            </div>
            <div class="col-md-3">
                <div><i class="bi bi-clipboard-data-fill"></i> IMC: <span id= "modal-clasificacion_imc">-</span></div>
              </div>
            <div class="col-md-3">
              <div><i class="bi bi-droplet-fill"></i> Glucosa: <span id="modal-glucosa">-</span> mg/dL</div>
            </div>
            <div class="col-md-3"> 
              <div><i class="bi bi-heart-pulse"></i> Colesterol: <span id="modal-colesterol">-</span> mg/dL</div>
            </div>
            <div class="col-md-3"> 
                <div><i class="bi bi-heart-pulse"></i> Trigliceridos: <span id="modal-trigliceridos">-</span> mg/dL</div>
              </div>
            <div class="col-md-3">
              <div><i class="bi bi-heart"></i> Tension Arterial: <span id="modal-tension_arterial">-</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Formularios si ya estan hechos -->
      <div class="card card-custom ">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
                <h5>Formularios</h5>
                <div>
                <h5>Status: </h5>
                </div>
            </div>
          
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span><strong>Estilo de Vida:</strong></span>
                <!-- Status con rect√°ngulo de color din√°mico -->
                <label for="status" class="form-label"></label>
                <div id="status-apgar" class="mb-3">
                    <div id="status-rectangle-apgar" class="status-rectangle p-4">
                        <span id="status-text-apgar" class="text-white">No lo ha realizado</span>
                    </div>
                </div>
            </li>
                
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span><strong>DASS-21:</strong></span>
                <!-- Status con rect√°ngulo de color din√°mico -->
                <label for="status" class="form-label"></label>
                <div id="status-sisco" class="mb-3">
                    <div id="status-rectangle-sisco" class="status-rectangle p-4">
                        <span id="status-text-sisco" class="text-white">No lo ha realizado</span>
                    </div>
                </div>
            </li>
          </ul>
        </div>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener la matr√≠cula desde la URL
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (matricula) {
            // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
            const enlacePuntajes = document.getElementById("enlacePuntajes");
            enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
        }
    });
    document.addEventListener("DOMContentLoaded", function() {
    const params = new URLSearchParams(window.location.search);
    const matricula = params.get("matricula_alum");

    if (matricula) {
        const linkHistorial = document.getElementById("linkHistorial");
        linkHistorial.href = `HistorialPatologicoAlum.html?matricula_alum=${matricula}`;
    }
});

</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener la matr√≠cula desde la URL
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (matricula) {
            // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
            const enlacePuntajes = document.getElementById("enlacePuntajes");
            enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
        }
    });

    document.addEventListener("DOMContentLoaded", function() {
    const params = new URLSearchParams(window.location.search);
    const matricula = params.get("matricula_alum");

    if (matricula) {
        const linkPerfil = document.getElementById("linkPerfil");
        linkPerfil.href = `expediente.html?matricula_alum=${matricula}`;
    }
});

</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener la matr√≠cula desde la URL
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (matricula) {
            // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
            const enlacePuntajes = document.getElementById("enlacePuntajes");
            enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
        }
    });

    document.addEventListener("DOMContentLoaded", function() {
    const params = new URLSearchParams(window.location.search);
    const matricula = params.get("matricula_alum");

    if (matricula) {
        const linkDatos = document.getElementById("linkDatos");
        linkDatos.href = `datosfisicosalumnos.html?matricula_alum=${matricula}`;
    }
});

</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener la matr√≠cula desde la URL
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (matricula) {
            // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
            const enlacePuntajes = document.getElementById("enlacePuntajes");
            enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
        }
    });

    document.addEventListener("DOMContentLoaded", function() {
    const params = new URLSearchParams(window.location.search);
    const matricula = params.get("matricula_alum");

    if (matricula) {
        const linkDass = document.getElementById("linkDass");
        linkDass.href = `formulariodass.html?matricula_alum=${matricula}`;
    }
});

</script>

<script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener la matr√≠cula desde la URL
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                // Actualizar el enlace de "Estilo de Vida" con la matr√≠cula
                const enlacePuntajes = document.getElementById("enlacePuntajes");
                enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                const linkEstilo = document.getElementById("linkEstilo");
                linkEstilo.href = `formularioestilo.html?matricula_alum=${matricula}`;
            }
        });

    </script>



<script>
    function cargarHistorialClinico(matricula) {
        fetch(`historial.php?matricula_alum=${matricula}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }

                // Llenar los campos del historial cl√≠nico
                document.getElementById("sobrepeso").value = data.sobrepeso;
                document.getElementById("diabetes").value = data.diabetes;
                document.getElementById("hipertension").value = data.hipertension;
                document.getElementById("trigliceridos").value = data.trigliceridos;
                document.getElementById("colesterol").value = data.colesterol;
                document.getElementById("hepatitis").value = data.hepatitis;
                document.getElementById("higado").value = data.higado_graso;
                document.getElementById("cardiopatias").value = data.cardiopatias;
                document.getElementById("nefropatias").value = data.nefropatias;
                document.getElementById("estre√±imiento").value = data.estre√±imiento;
                document.getElementById("gastritis").value = data.gastritis;
                document.getElementById("cancer").value = data.cancer;
                document.getElementById("tienesEnfermedad").value = data.otros;
                document.getElementById("Tratamiendo").value = data.tratamiento;
            })
            .catch(error => console.error("Error al cargar el historial cl√≠nico:", error));
    }

    function cargarPerfil() {
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (!matricula) {
            alert("No se proporcion√≥ una matr√≠cula.");
            return;
        }

        fetch(`perfil.php?matricula_alum=${matricula}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }
                // Verificar historial
                fetch(`historial.php?matricula_alum=${matricula}`)
                  .then(res => res.json())
                  .then(historial => {
                    const historialVacio = !historial || Object.keys(historial).length === 0;

                    // Verificar si hay datos f√≠sicos cargados
                    const tieneDatosFisicos = data.fechas && data.fechas.length > 0;

                    verificarEstadoExpediente(data, historialVacio, tieneDatosFisicos);
                  });


               // document.getElementById("fotoAlumno").src = data.foto;
                document.getElementById("matricula").value = data.matricula_alum;
                document.getElementById("nombre").value = data.nombres_alum + " " + data.ape_paterno_alum + " " + data.ape_materno_alum;
                document.getElementById("sexo").value = data.sexo;
                document.getElementById("edad").value = data.edad_alum;
                document.getElementById("facultad").value = data.nombre_facultad;
                document.getElementById("carrera").value = data.nombre_carrera;
                document.getElementById("email").value = data.correo_alum;

                // üü¢ Estado del formulario Apgar
                const statusRectangleApgar = document.getElementById('status-rectangle-apgar');
                const statusTextApgar = document.getElementById('status-text-apgar');
                if (data.estilo_vida_realizado) {
                    statusTextApgar.textContent = 'Ya realizado';
                    statusRectangleApgar.classList.add('bg-success'); // Color verde
                } else {
                    statusTextApgar.textContent = 'No lo ha realizado';
                    statusRectangleApgar.classList.add('bg-danger'); // Color rojo
                }

                // üü¢ Estado del formulario Sisco
                const statusRectangleSisco = document.getElementById('status-rectangle-sisco');
                const statusTextSisco = document.getElementById('status-text-sisco');
                if (data.dass_realizado) {
                    statusTextSisco.textContent = 'Ya realizado';
                    statusRectangleSisco.classList.add('bg-success');
                } else {
                    statusTextSisco.textContent = 'No lo ha realizado';
                    statusRectangleSisco.classList.add('bg-danger');
                }
                })
                .catch(error => console.error("Error al cargar el perfil:", error));
                    // Cargar el historial cl√≠nico
                 cargarHistorialClinico(matricula);

                
        }

        document.addEventListener("DOMContentLoaded", cargarPerfil);

        function cargarDatosFisicosRecientes(matricula) {
    fetch(`perfil.php?matricula_alum=${matricula}`)
        .then(response => response.json())
        .then(data => {
            if (data.fechas && data.fechas.length > 0) {
                const ultimaFecha = data.fechas[data.fechas.length - 1];
                document.getElementById("fecha-datos-fisicos").textContent = ultimaFecha;

                fetch(`datos_fisicos_detalle.php?matricula_alum=${matricula}&fecha=${ultimaFecha}`)
                    .then(response => response.json())
                    .then(datos => {
                        document.getElementById("peso").textContent = datos.peso || "-";
                        document.getElementById("modal-talla").textContent = datos.talla || "-";
                        document.getElementById("modal-imc").textContent = datos.imc || "-";
                        document.getElementById("modal-clasificacion_imc").textContent = datos.clasificacion_imc || "-";
                        document.getElementById("modal-glucosa").textContent = datos.glucosa || "-";
                        document.getElementById("modal-colesterol").textContent = datos.colesterol || "-";
                        document.getElementById("modal-trigliceridos").textContent = datos.trigliceridos || "-";
                        document.getElementById("modal-tension_arterial").textContent = datos.tension_arterial || "-";
                    })
                    .catch(error => console.error("Error al cargar los datos f√≠sicos:", error));
            } else {
                document.getElementById("fecha-datos-fisicos").textContent = "Sin datos";
            }
        })
        .catch(error => console.error("Error al cargar fechas:", error));
}
    

    document.addEventListener("DOMContentLoaded", function() {
        const params = new URLSearchParams(window.location.search);
        const matricula = params.get("matricula_alum");

        if (matricula) {
        cargarDatosFisicosRecientes(matricula);
    }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtener botones
        const btnFormularios = document.querySelector(".btn-formularios");
        const btnHistorial = document.querySelector(".btn-historial");
        const btnDatosFisicos = document.querySelector(".btn-datos-fisicos");
    
        // Obtener cuadros y t√≠tulo
        const tituloFormulario = document.getElementById("titulo-formulario");
        const tituloSeccion = document.getElementById("titulo-seccion");
        const formularioCuadros = document.getElementById("formulario-cuadros");
        const historialCuadro = document.getElementById("historial-cuadro");
        const datosFisicosCuadro = document.getElementById("datos-fisicos-cuadro");
    
        // Funci√≥n para actualizar el t√≠tulo y mostrar contenido
        function mostrarSeccion(titulo, mostrarFormulario, mostrarHistorial, mostrarDatosFisicos) {
            // Cambiar el texto del t√≠tulo
            tituloSeccion.innerText = titulo;
            // Mostrar el t√≠tulo
            tituloFormulario.classList.remove("d-none");
    
            // Controla la visibilidad de los cuadros
            formularioCuadros.classList.toggle("d-none", !mostrarFormulario);
            historialCuadro.classList.toggle("d-none", !mostrarHistorial);
            datosFisicosCuadro.classList.toggle("d-none", !mostrarDatosFisicos);
        }
    
        // Al cargar la p√°gina, ocultamos todas las secciones (excepto el t√≠tulo)
        formularioCuadros.classList.add("d-none");
        historialCuadro.classList.add("d-none");
        datosFisicosCuadro.classList.add("d-none");
    
        // Evento para mostrar Formularios
        btnFormularios.addEventListener("click", function() {
            mostrarSeccion("Formularios", true, false, false);
        });
    
        // Evento para mostrar Historial Cl√≠nico
        btnHistorial.addEventListener("click", function() {
            mostrarSeccion("Historial Heredo-Familiar", false, true, false);
        });
    
        // Evento para mostrar Datos F√≠sicos
        btnDatosFisicos.addEventListener("click", function() {
            mostrarSeccion("Datos F√≠sicos", false, false, true);
        });
    });


    document.addEventListener("DOMContentLoaded", function () {
  const params = new URLSearchParams(window.location.search);
  const matricula = params.get("matricula_alum");

  if (!matricula) return;

  Promise.all([
    fetch(`perfil.php?matricula_alum=${matricula}`).then(r => r.json()),
    fetch(`historial.php?matricula_alum=${matricula}`).then(r => r.json())
  ])
  .then(([perfil, historial]) => {
    // ‚öôÔ∏è Datos f√≠sicos ya vienen desde perfil.php
    const tieneDatosFisicos = perfil.fechas && perfil.fechas.length > 0;
    const historialVacio = Object.keys(historial).length === 0;

    // üß† Mostrar modal informativo
    mostrarModalEstado(perfil, tieneDatosFisicos, historialVacio);
  });
});

</script>

<!-- Modal de estado de expediente -->
<div class="modal fade" id="modalEstadoExpediente" tabindex="-1" aria-labelledby="modalEstadoExpedienteLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-info">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title" id="modalEstadoExpedienteLabel">Estado del Expediente</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body" id="contenido-estado-expediente">
        <!-- Este contenido se llena por JS -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-info" data-bs-dismiss="modal">Entendido</button>
      </div>
    </div>
  </div>
</div>

<script>
function mostrarModalEstado(perfil, tieneDatosFisicos, historialVacio) {
  const mensajes = [];
  let completo = true;

  if (!perfil.estilo_vida_realizado) {
    mensajes.push("‚ùå Falta completar el formulario <strong>Estilo de Vida</strong>.");
    completo = false;
  } else {
    mensajes.push("‚úÖ Formulario Estilo de Vida completado.");
  }

  if (!perfil.dass_realizado) {
    mensajes.push("‚ùå Falta completar el cuestionario <strong>DASS-21</strong>.");
    completo = false;
  } else {
    mensajes.push("‚úÖ Cuestionario DASS-21 completado.");
  }

  if (!tieneDatosFisicos) {
    mensajes.push("‚ùå No hay datos f√≠sicos registrados.");
    completo = false;
  } else {
    mensajes.push("‚úÖ Datos f√≠sicos disponibles.");
  }

  if (historialVacio) {
    mensajes.push("‚ùå Historial cl√≠nico no registrado.");
    completo = false;
  } else {
    mensajes.push("‚úÖ Historial cl√≠nico completo.");
  }

  document.getElementById("contenido-estado-expediente").innerHTML = mensajes.join("<br>");
  const modal = new bootstrap.Modal(document.getElementById("modalEstadoExpediente"));
  modal.show();
}

</script>



</body>
</html>