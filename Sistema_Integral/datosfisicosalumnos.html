<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Datos F칤sicos</title>
    <link rel="stylesheet" href="css/expediente.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/ico/logo_pequeno.ico">
    <style>

    </style>
</head>

<body>

    <div class="container-fluid">
        <div class="row h-100">

            <!-- Sidebar -->
            <div class="col-md-2 sidebar d-flex flex-column p-3">
                <h4 class="text-center">Men칰</h4>
                <a id="linkPerfil" href="#"><i class="bi bi-person-circle me-2"></i> Perfil</a>
                <a href="#"><i class="bi bi-clipboard-data me-2"></i> Datos F칤sicos</a>
                <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-heart-pulse me-2"></i> Formularios
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">DASS-21</a></li>
                        <li><a class="dropdown-item" href="#">Estilo de Vida</a></li>
                    </ul>
                </div>
                <a id="linkHistorial" href="#"><i class="bi bi-house-heart-fill me-2"></i> Historial Patol칩gico</a>
                <a href="ListadoAlumnos.html"><i class="bi bi-box-arrow-left me-2"></i> Salir</a>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 p-4">
                <div class="nav d-flex justify-content-between align-items-center mb-4">
                    <img src="/images/logo_unacar (1).png" alt="logo" class="unacar">
                    <h2>Datos F칤sicos del Alumno</h2>
                    <button class="btn btn-primary" disabled></button>
                </div>

                <!-- Datos del alumno -->
                <div class="card card-custom mb-4">
                    <div class="card-body d-flex">
                        <div class="left-section">
                            <img src="/imagenes/usuario.png" alt="Foto Alumno" class="profile-img mb-3">
                        </div>
                        <div class="right-section">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Nombre:</span>
                                        <input type="text" class="form-control" id="nombre" name="nombre" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Edad:</span>
                                        <input type="text" class="form-control" id="edad" name="edad" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Sexo:</span>
                                        <input type="text" class="form-control" id="sexo" name="sexo" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Matr칤cula:</span>
                                        <input type="text" class="form-control" id="matricula" name="matricula"
                                            disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Carrera:</span>
                                        <input type="text" class="form-control" name="carrera" id="carrera" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Facultad:</span>
                                        <input type="text" class="form-control" name="facultad" id="facultad" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Correo Electr칩nico:</span>
                                        <input type="email" class="form-control" name="email" id="email" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Signos vitales / otros datos -->
                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="display-6">Datos F칤sicos</h5>
                            <div>
                                <h5><i class="bi bi-calendar2-date-fill"></i>Fecha: </h5> <span
                                    id="fecha-datos-fisicos"></span>
                            </div>
                        </div>



                        <div class="row g-3 mt-3">
                            <!--cadera cintura-->
                            <div class="col-md-12">
                                <h1 class="display-6"> Valores de Cintura / Cadera</h1>
                            </div>

                            <div class="col-md-2 cuadro">
                                <div><i class="bi bi-receipt-cutoff"></i> cintura: <span id="modal-cintura">-</span> cm
                                </div>
                            </div>
                            <div class="col-md-2 cuadro">
                                <div><i class="bi bi-receipt-cutoff"></i> Cadera: <span id="modal-cadera">-</span> cm
                                </div>
                            </div>
                            <div class="col-md-4 cuadro">
                                <div><i class="bi bi-clipboard-data-fill"></i> Clasificaci칩n de Cintura/Cadera: <span
                                        id="modal-clacin">-</span>
                                </div>
                            </div>
                            <div class="col-md-2 cuadro">
                                <div><i class="bi bi-person-fill-up"></i> ICC: <span id="modal-icc">-</span>
                                </div>
                            </div>
                            <div class="col-md-4 cuadro">
                                <div><i class="bi bi-person-fill-up"></i> Clasificaci칩n de ICC: <span
                                        id="modal-clasicc">-</span>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <h1 class="display-6"> Valores de Peso y Talla</h1>
                            </div>
                            <!--tallas-->

                            <div class="col-md-2 cuadro">
                                <div><i class="bi bi-piggy-bank"></i>Peso: <span id="peso">-</span> kg</div>
                            </div>
                            <div class="col-md-2 cuadro">
                                <div><i class="bi bi-person-fill-up"></i> Talla: <span id="modal-talla">-</span> cm
                                </div>
                            </div>

                            <div class="col-md-2 cuadro">
                                <div><i class="bi bi-clipboard-data-fill"></i> IMC: <span id="modal-imc">-</span>
                                </div>
                            </div>
                            <div class="col-md-4 cuadro">
                                <div><i class="bi bi-person-check-fill"></i> Clasificaci칩n IMC: <span
                                        id="modal-clasificacionimc">-</span>
                                </div>
                            </div>
                            <div class="col-md-2 cuadro">
                                <div><i class="bi bi-patch-check"></i> ICE: <span id="modal-ice">-</span>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <h1 class="display-6"> Valores de Porcentaje Masa Grasa</h1>
                            </div>

                            <!--masa grasa-->
                            <div class="col-md-3 cuadro">
                                <div><i class="bi bi-exclamation-square"></i> MB(Kcal): <span id="modal-mb">-</span>
                                </div>
                            </div>
                            <div class="col-md-3 cuadro">
                                <div><i class="bi bi-activity"></i> Nivel de actividad: <span id="modal-acti">-</span>
                                </div>
                            </div>
                            <div class="col-md-2 cuadro">
                                <div><i class="bi bi-person-check-fill"></i> GET: <span id="modal-get">-</span>
                                </div>
                            </div>
                            <div class="col-md-3 cuadro">
                                <div><i class="bi bi-exclamation-square"></i> Porcentaje de masa grasa: <span
                                        id="modal-pormasagrasa">-</span>
                                </div>
                            </div>
                            <div class="col-md-2 cuadro">
                                <div><i class="bi bi-clipboard-check"></i> Valor ideal de % grasa: <span
                                        id="modal-ideal">-</span>
                                </div>
                            </div>
                            <div class="col-md-4 cuadro">
                                <div><i class="bi bi-bar-chart-steps"></i> Clasificaci칩n de % grasa: <span
                                        id="modal-clasificaciongrasa">-</span>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <h1 class="display-6"> Valores de Porcentaje de Masa Magra y Agua</h1>
                            </div>
                            <!--masa magra-->
                            <div class="col-md-3 cuadro">
                                <div><i class="bi bi-droplet-fill"></i> Masa magra: <span
                                        id="modal-masamagra">-</span>
                                </div>
                            </div>
                            <div class="col-md-3 cuadro">
                                <div><i class="bi bi-droplet-half"></i> Agua Total(litros): <span
                                        id="modal-aguatotal">-</span>
                                </div>
                            </div>
                            <div class="col-md-4 cuadro">
                                <div><i class="bi bi-water"></i> Porcentaje de agua total: <span
                                        id="modal-porcentajeagua">-</span>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <h1 class="display-6">Valores de Glucosa y Colesterol</h1>
                            </div>
                            <div class="col-md-3 cuadro">
                                <div><i class="bi bi-heart-pulse"></i> Glucosa: <span id="modal-glucosa">-</span>
                                </div>
                            </div>
                            <div class="col-md-4 cuadro">
                                <div><i class="bi bi-droplet-half"></i> Clasificacion de Glucosa: <span
                                        id="modal-clasificacionglucosa">-</span>
                                </div>
                            </div>

                            <div class="col-md-3 cuadro">
                                <div><i class="bi bi-clipboard-data"></i> Colesterol: <span
                                        id="modal-colesterol">-</span>
                                </div>
                            </div>

                            <div class="col-md-4 cuadro">
                                <div><i class="bi bi-clipboard2-heart-fill"></i> Clasificacion de Colesterol: <span
                                        id="modal-clasificacioncolesterol">-</span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <h1 class="display-6"> Valores de Triglic칠ridos y Tensi칩n Arterial</h1>
                            </div>

                            <div class="col-md-3 cuadro">
                                <div><i class="bi bi-clipboard-pulse"></i> Trigliceridos: <span
                                        id="modal-trigliceridos">-</span></div>
                            </div>
                            <div class="col-md-4 cuadro">
                                <div><i class="bi bi-clipboard2-heart-fill"></i> Clasificacion de Trigliceridos: <span
                                        id="modal-clasificaciontrigli">-</span>
                                </div>
                            </div>
                            <div class="col-md-3 cuadro">
                                <div><i class="bi bi-heart-pulse"></i> Tension Arterial: <span
                                        id="modal-tensionarterial">-</span></div>
                            </div>
                            <div class="col-md-4 cuadro">
                                <div><i class="bi bi-person-hearts"></i> Clasificaci칩n de T.A: <span
                                        id="modal-clasificacionta">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener la matr칤cula desde la URL
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                // Actualizar el enlace de "Estilo de Vida" con la matr칤cula
                const enlacePuntajes = document.getElementById("enlacePuntajes");
                enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
            }
        });
        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                const linkHistorial = document.getElementById("linkHistorial");
                linkHistorial.href = `HistorialPatologicoAlum.html?matricula_alum=${matricula}`;
            }
        });

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener la matr칤cula desde la URL
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                // Actualizar el enlace de "Estilo de Vida" con la matr칤cula
                const enlacePuntajes = document.getElementById("enlacePuntajes");
                enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                const linkPerfil = document.getElementById("linkPerfil");
                linkPerfil.href = `expediente.html?matricula_alum=${matricula}`;
            }
        });

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener la matr칤cula desde la URL
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                // Actualizar el enlace de "Estilo de Vida" con la matr칤cula
                const enlacePuntajes = document.getElementById("enlacePuntajes");
                enlacePuntajes.href = `puntajes.html?matricula=${matricula}`;
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                const linkDatos = document.getElementById("linkDatos");
                linkDatos.href = `datosfisicosalumnos.html?matricula_alum=${matricula}`;
            }
        });

    </script>



    <script>

        function cargarPerfil() {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (!matricula) {
                alert("No se proporcion칩 una matr칤cula.");
                return;
            }

            fetch(`perfil.php?matricula_alum=${matricula}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }
                    // Verificar historial
                    fetch(`historial.php?matricula_alum=${matricula}`)
                        .then(res => res.json())
                        .then(historial => {
                            const historialVacio = !historial || Object.keys(historial).length === 0;

                            // Verificar si hay datos f칤sicos cargados
                            const tieneDatosFisicos = data.fechas && data.fechas.length > 0;

                            verificarEstadoExpediente(data, historialVacio, tieneDatosFisicos);
                        });


                    // document.getElementById("fotoAlumno").src = data.foto;
                    document.getElementById("matricula").value = data.matricula_alum;
                    document.getElementById("nombre").value = data.nombres_alum + " " + data.ape_paterno_alum + " " + data.ape_materno_alum;
                    document.getElementById("sexo").value = data.sexo;
                    document.getElementById("edad").value = data.edad_alum;
                    document.getElementById("facultad").value = data.nombre_facultad;
                    document.getElementById("carrera").value = data.nombre_carrera;
                    document.getElementById("email").value = data.correo_alum;

                })
                .catch(error => console.error("Error al cargar el perfil:", error));
        }

        document.addEventListener("DOMContentLoaded", cargarPerfil);

        function cargarDatosFisicosRecientes(matricula) {
            fetch(`perfil.php?matricula_alum=${matricula}`)
                .then(response => response.json())
                .then(data => {
                    if (data.fechas && data.fechas.length > 0) {
                        const ultimaFecha = data.fechas[data.fechas.length - 1];
                        document.getElementById("fecha-datos-fisicos").textContent = ultimaFecha;

                        fetch(`datos_fisicos_detalle.php?matricula_alum=${matricula}&fecha=${ultimaFecha}`)
                            .then(response => response.json())
                            .then(datos => {
                                document.getElementById("modal-cintura").textContent = datos.cintura || "-";
                                document.getElementById("modal-cadera").textContent = datos.cadera || "-";
                                document.getElementById("modal-clacin").textContent = datos.clasificacion_cintura_cadera || "-";
                                document.getElementById("modal-icc").textContent = datos.icc || "-";
                                document.getElementById("modal-clasicc").textContent = datos.clasificacion_de_icc || "-";
                                document.getElementById("peso").textContent = datos.peso || "-";
                                document.getElementById("modal-talla").textContent = datos.talla || "-";
                                document.getElementById("modal-imc").textContent = datos.imc || "-";
                                document.getElementById("modal-clasificacionimc").textContent = datos.clasificacion_imc || "-";
                                document.getElementById("modal-ice").textContent = datos.ice || "-";
                                document.getElementById("modal-mb").textContent = datos.mb || "-";
                                document.getElementById("modal-acti").textContent = datos.actividad1 || "-";
                                document.getElementById("modal-get").textContent = datos.get1 || "-";
                                document.getElementById("modal-pormasagrasa").textContent = datos.porcentaje_masa_grasa || "-";
                                document.getElementById("modal-ideal").textContent = datos.valor_ideal_porcentaje_grasa || "-";
                                document.getElementById("modal-clasificaciongrasa").textContent = datos.clasificacion_porcentaje_grasa || "-";
                                document.getElementById("modal-masamagra").textContent = datos.masa_magra || "-";
                                document.getElementById("modal-aguatotal").textContent = datos.agua_total || "-";
                                document.getElementById("modal-porcentajeagua").textContent = datos.porcentaje_agua_total || "-";
                                document.getElementById("modal-glucosa").textContent = datos.glucosa || "-";
                                document.getElementById("modal-clasificacionglucosa").textContent = datos.clasificacion_glucosa || "-";
                                document.getElementById("modal-colesterol").textContent = datos.colesterol || "-";
                                document.getElementById("modal-clasificacioncolesterol").textContent = datos.clasificacion_colesterol || "-";
                                document.getElementById("modal-trigliceridos").textContent = datos.trigliceridos || "-";
                                document.getElementById("modal-clasificaciontrigli").textContent = datos.clasificacion_trigliceridos || "-";
                                document.getElementById("modal-tensionarterial").textContent = datos.tension_arterial || "-";
                                document.getElementById("modal-clasificacionta").textContent = datos.clasificacion_tension_arterial || "-";
                            })
                            .catch(error => console.error("Error al cargar los datos f칤sicos:", error));
                    } else {
                        document.getElementById("fecha-datos-fisicos").textContent = "Sin datos";
                    }
                })
                .catch(error => console.error("Error al cargar fechas:", error));
        }


        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (matricula) {
                cargarDatosFisicosRecientes(matricula);
            }
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtener botones
            const btnFormularios = document.querySelector(".btn-formularios");
            const btnHistorial = document.querySelector(".btn-historial");
            const btnDatosFisicos = document.querySelector(".btn-datos-fisicos");

            // Obtener cuadros y t칤tulo
            const tituloFormulario = document.getElementById("titulo-formulario");
            const tituloSeccion = document.getElementById("titulo-seccion");
            const formularioCuadros = document.getElementById("formulario-cuadros");
            const historialCuadro = document.getElementById("historial-cuadro");
            const datosFisicosCuadro = document.getElementById("datos-fisicos-cuadro");

            // Funci칩n para actualizar el t칤tulo y mostrar contenido
            function mostrarSeccion(titulo, mostrarFormulario, mostrarHistorial, mostrarDatosFisicos) {
                // Cambiar el texto del t칤tulo
                tituloSeccion.innerText = titulo;
                // Mostrar el t칤tulo
                tituloFormulario.classList.remove("d-none");

                // Controla la visibilidad de los cuadros
                formularioCuadros.classList.toggle("d-none", !mostrarFormulario);
                historialCuadro.classList.toggle("d-none", !mostrarHistorial);
                datosFisicosCuadro.classList.toggle("d-none", !mostrarDatosFisicos);
            }

            // Al cargar la p치gina, ocultamos todas las secciones (excepto el t칤tulo)
            formularioCuadros.classList.add("d-none");
            historialCuadro.classList.add("d-none");
            datosFisicosCuadro.classList.add("d-none");

            // Evento para mostrar Formularios
            btnFormularios.addEventListener("click", function () {
                mostrarSeccion("Formularios", true, false, false);
            });

            // Evento para mostrar Historial Cl칤nico
            btnHistorial.addEventListener("click", function () {
                mostrarSeccion("Historial Heredo-Familiar", false, true, false);
            });

            // Evento para mostrar Datos F칤sicos
            btnDatosFisicos.addEventListener("click", function () {
                mostrarSeccion("Datos F칤sicos", false, false, true);
            });
        });


        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (!matricula) return;

            Promise.all([
                fetch(`perfil.php?matricula_alum=${matricula}`).then(r => r.json()),
                fetch(`historial.php?matricula_alum=${matricula}`).then(r => r.json())
            ])
                .then(([perfil, historial]) => {
                    // 丘뙖잺 Datos f칤sicos ya vienen desde perfil.php
                    const tieneDatosFisicos = perfil.fechas && perfil.fechas.length > 0;
                    const historialVacio = Object.keys(historial).length === 0;

                    // 游 Mostrar modal informativo
                    mostrarModalEstado(perfil, tieneDatosFisicos, historialVacio);
                });
        });

    </script>

    <!-- Modal de estado de expediente -->
    <div class="modal fade" id="modalEstadoExpediente" tabindex="-1" aria-labelledby="modalEstadoExpedienteLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-info">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalEstadoExpedienteLabel">Estado del Expediente</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                </div>
                <div class="modal-body" id="contenido-estado-expediente">
                    <!-- Este contenido se llena por JS -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info" data-bs-dismiss="modal">Entendido</button>
                </div>
            </div>
        </div>
    </div>



</body>

</html>