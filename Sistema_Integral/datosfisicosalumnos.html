<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Datos Físicos</title>
    <link rel="stylesheet" href="css/expediente.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/ico/logo_pequeno.ico">
    <style>
        /* Estilos para carpetas de datos físicos */
        .accordion-item {
            position: relative;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .accordion-button {
            background: linear-gradient(135deg, #fcd34d, #fbbf24) !important;
            /* amarillo carpeta */
            color: #3b3b3b !important;
            font-weight: 700;
            font-size: 1.1rem;
            text-align: center;
            justify-content: center;
            padding: 18px 25px;
            border: none;
            border-radius: 0 !important;
            transition: all 0.3s ease;
            clip-path: polygon(0 20px,
                    70px 20px,
                    85px 0,
                    100% 0,
                    100% 100%,
                    0 100%);
            box-shadow:
                0 -2px 8px rgba(0, 0, 0, 0.2),
                0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .accordion-button:not(.collapsed) {
            background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
            color: #2d2d2d !important;
            transform: translateY(-3px);
            box-shadow:
                0 -3px 12px rgba(0, 0, 0, 0.3),
                0 6px 14px rgba(0, 0, 0, 0.2);
        }

        .accordion-button:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }

        /* Ícono de flecha en color oscuro */
        .accordion-button::after {
            filter: brightness(0);
        }

        /* Cuerpo del acordeón */
        .accordion-body {
            background: #fff9e6;
            /* tono crema para recordar papel */
            font-size: 1rem;
            text-align: center;
            padding: 25px;
        }

        .accordion-button:focus {
            box-shadow:
                0 0 0 0.25rem rgba(30, 64, 175, 0.25),
                0 -2px 8px rgba(30, 64, 175, 0.3),
                0 4px 12px rgba(0, 0, 0, 0.15);
            border-color: transparent;
        }

        /* Decoración adicional de carpeta */
        .accordion-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 80px;
            width: 25px;
            height: 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            clip-path: polygon(0 100%, 100% 0, 100% 100%);
            pointer-events: none;
        }

        /* Cuerpo de la carpeta */
        .accordion-collapse {
            border: 3px solid var(--azul-rey);
            border-top: none;
            background: white;
            box-shadow:
                inset 0 3px 8px rgba(0, 0, 0, 0.05),
                0 4px 12px rgba(0, 0, 0, 0.1);
        }


        .dato-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--sombra-suave);
        }

        .dato-item:hover {
            border-color: var(--azul-claro);
            transform: translateX(5px);
            box-shadow: var(--sombra-media);
        }

        .dato-item i {
            color: var(--azul-rey);
            font-size: 1.5rem;
            min-width: 30px;
            text-align: center;
        }

        .dato-label {
            font-weight: 600;
            color: var(--gris-oscuro);
            margin-right: 8px;
            min-width: 180px;
        }

        .dato-value {
            font-weight: 700;
            color: var(--azul-oscuro);
            font-size: 1.05rem;
        }

        .section-icon {
            font-size: 1rem;
            margin-right: 8px;
        }

        .fecha-badge {
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: var(--sombra-suave);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Responsive para datos físicos */
        @media (max-width: 768px) {
            .dato-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .dato-label {
                min-width: auto;
            }

            .accordion-button {
                font-size: 0.9rem;
                padding: 15px;
            }
        }
    </style>
</head>

<body>

    <div class="container-fluid">
        <div class="row h-100">

            <!-- Sidebar -->
            <div class="col-md-2 sidebar d-flex flex-column p-3">
                <h4 class="text-center">Menú</h4>
                <a id="linkPerfil" href="#"><i class="bi bi-person-circle me-2"></i> Perfil</a>
                <a href="#"><i class="bi bi-clipboard-data me-2"></i> Datos Físicos</a>
                <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-heart-pulse me-2"></i> Formularios
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" id="linkDass" href="#">DASS-21</a></li>
                        <li><a class="dropdown-item" id="linkEstilo" href="#">Estilo de Vida</a></li>
                    </ul>
                </div>
                <a id="linkHistorial" href="#"><i class="bi bi-house-heart-fill me-2"></i> Historial Patológico</a>
                <a href="ListadoAlumnos.html"><i class="bi bi-box-arrow-left me-2"></i> Salir</a>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 p-4">
                <div class="nav d-flex justify-content-between align-items-center mb-4">
                    <img src="/images/logo_unacar (1).png" alt="logo" class="unacar">
                    <h2>Datos Físicos del Alumno</h2>
                    <button class="btn btn-primary" disabled></button>
                </div>

                <!-- Datos del alumno -->
                <div class="card card-custom mb-4">
                    <div class="card-body d-flex">
                        <div class="left-section">
                            <img src="/imagenes/usuario.png" alt="Foto Alumno" class="profile-img mb-3">
                        </div>
                        <div class="right-section">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Nombre:</span>
                                        <input type="text" class="form-control" id="nombre" name="nombre" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Edad:</span>
                                        <input type="text" class="form-control" id="edad" name="edad" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Sexo:</span>
                                        <input type="text" class="form-control" id="sexo" name="sexo" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Matrícula:</span>
                                        <input type="text" class="form-control" id="matricula" name="matricula"
                                            disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Carrera:</span>
                                        <input type="text" class="form-control" name="carrera" id="carrera" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Facultad:</span>
                                        <input type="text" class="form-control" name="facultad" id="facultad" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text">Correo Electrónico:</span>
                                        <input type="email" class="form-control" name="email" id="email" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Datos Físicos con Acordeón -->
                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5>
                                <i class="bi bi-clipboard-pulse"></i>
                                Datos Físicos Recientes
                            </h5>
                            <span class="fecha-badge">
                                <i class="bi bi-calendar2-date-fill"></i>
                                <span id="fecha-datos-fisicos">Cargando...</span>
                            </span>
                        </div>

                        <!-- Acordeón de Datos Físicos -->
                        <div class="accordion" id="accordionDatosFisicos">

                            <!-- Sección 1: Cintura/Cadera -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseCinturaCadera">
                                        <i class="bi bi-rulers section-icon"></i>
                                        Valores de Cintura / Cadera
                                    </button>
                                </h2>
                                <div id="collapseCinturaCadera" class="accordion-collapse collapse"
                                    data-bs-parent="#accordionDatosFisicos">
                                    <div class="accordion-body">
                                        <div class="dato-item">
                                            <i class="bi bi-receipt-cutoff"></i>
                                            <span class="dato-label">Cintura:</span>
                                            <span class="dato-value" id="modal-cintura">-</span>
                                            <span class="text-muted">cm</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-receipt-cutoff"></i>
                                            <span class="dato-label">Cadera:</span>
                                            <span class="dato-value" id="modal-cadera">-</span>
                                            <span class="text-muted">cm</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-person-fill-up"></i>
                                            <span class="dato-label">ICC:</span>
                                            <span class="dato-value" id="modal-icc">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-clipboard-data-fill"></i>
                                            <span class="dato-label">Clasificación Cintura/Cadera:</span>
                                            <span class="dato-value" id="modal-clacin">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-person-check-fill"></i>
                                            <span class="dato-label">Clasificación de ICC:</span>
                                            <span class="dato-value" id="modal-clasicc">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 2: Peso y Talla -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapsePesoTalla">
                                        <i class="bi bi-person-fill-up section-icon"></i>
                                        Valores de Peso y Talla
                                    </button>
                                </h2>
                                <div id="collapsePesoTalla" class="accordion-collapse collapse"
                                    data-bs-parent="#accordionDatosFisicos">
                                    <div class="accordion-body">
                                        <div class="dato-item">
                                            <i class="bi bi-piggy-bank"></i>
                                            <span class="dato-label">Peso:</span>
                                            <span class="dato-value" id="peso">-</span>
                                            <span class="text-muted">kg</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-person-fill-up"></i>
                                            <span class="dato-label">Talla:</span>
                                            <span class="dato-value" id="modal-talla">-</span>
                                            <span class="text-muted">cm</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-clipboard-data-fill"></i>
                                            <span class="dato-label">IMC:</span>
                                            <span class="dato-value" id="modal-imc">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-person-check-fill"></i>
                                            <span class="dato-label">Clasificación IMC:</span>
                                            <span class="dato-value" id="modal-clasificacionimc">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-patch-check"></i>
                                            <span class="dato-label">ICE:</span>
                                            <span class="dato-value" id="modal-ice">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 3: Masa Grasa -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseMasaGrasa">
                                        <i class="bi bi-activity section-icon"></i>
                                        Valores de Porcentaje Masa Grasa
                                    </button>
                                </h2>
                                <div id="collapseMasaGrasa" class="accordion-collapse collapse"
                                    data-bs-parent="#accordionDatosFisicos">
                                    <div class="accordion-body">
                                        <div class="dato-item">
                                            <i class="bi bi-exclamation-square"></i>
                                            <span class="dato-label">MB (Kcal):</span>
                                            <span class="dato-value" id="modal-mb">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-activity"></i>
                                            <span class="dato-label">Nivel de actividad:</span>
                                            <span class="dato-value" id="modal-acti">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-person-check-fill"></i>
                                            <span class="dato-label">GET:</span>
                                            <span class="dato-value" id="modal-get">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-exclamation-square"></i>
                                            <span class="dato-label">Porcentaje de masa grasa:</span>
                                            <span class="dato-value" id="modal-pormasagrasa">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-clipboard-check"></i>
                                            <span class="dato-label">Valor ideal de % grasa:</span>
                                            <span class="dato-value" id="modal-ideal">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-bar-chart-steps"></i>
                                            <span class="dato-label">Clasificación de % grasa:</span>
                                            <span class="dato-value" id="modal-clasificaciongrasa">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 4: Masa Magra y Agua -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseMasaMagra">
                                        <i class="bi bi-droplet-fill section-icon"></i>
                                        Valores de Masa Magra y Agua
                                    </button>
                                </h2>
                                <div id="collapseMasaMagra" class="accordion-collapse collapse"
                                    data-bs-parent="#accordionDatosFisicos">
                                    <div class="accordion-body">
                                        <div class="dato-item">
                                            <i class="bi bi-droplet-fill"></i>
                                            <span class="dato-label">Masa magra:</span>
                                            <span class="dato-value" id="modal-masamagra">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-droplet-half"></i>
                                            <span class="dato-label">Agua Total (litros):</span>
                                            <span class="dato-value" id="modal-aguatotal">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-water"></i>
                                            <span class="dato-label">Porcentaje de agua total:</span>
                                            <span class="dato-value" id="modal-porcentajeagua">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 5: Glucosa y Colesterol -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseGlucosaCol">
                                        <i class="bi bi-heart-pulse section-icon"></i>
                                        Valores de Glucosa y Colesterol
                                    </button>
                                </h2>
                                <div id="collapseGlucosaCol" class="accordion-collapse collapse"
                                    data-bs-parent="#accordionDatosFisicos">
                                    <div class="accordion-body">
                                        <div class="dato-item">
                                            <i class="bi bi-heart-pulse"></i>
                                            <span class="dato-label">Glucosa:</span>
                                            <span class="dato-value" id="modal-glucosa">-</span>
                                            <span class="text-muted">mg/dL</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-droplet-half"></i>
                                            <span class="dato-label">Clasificación de Glucosa:</span>
                                            <span class="dato-value" id="modal-clasificacionglucosa">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-clipboard-data"></i>
                                            <span class="dato-label">Colesterol:</span>
                                            <span class="dato-value" id="modal-colesterol">-</span>
                                            <span class="text-muted">mg/dL</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-clipboard2-heart-fill"></i>
                                            <span class="dato-label">Clasificación de Colesterol:</span>
                                            <span class="dato-value" id="modal-clasificacioncolesterol">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 6: Triglicéridos y Tensión Arterial -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseTrigliceridos">
                                        <i class="bi bi-clipboard-pulse section-icon"></i>
                                        Valores de Triglicéridos y Tensión Arterial
                                    </button>
                                </h2>
                                <div id="collapseTrigliceridos" class="accordion-collapse collapse"
                                    data-bs-parent="#accordionDatosFisicos">
                                    <div class="accordion-body">
                                        <div class="dato-item">
                                            <i class="bi bi-clipboard-pulse"></i>
                                            <span class="dato-label">Triglicéridos:</span>
                                            <span class="dato-value" id="modal-trigliceridos">-</span>
                                            <span class="text-muted">mg/dL</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-clipboard2-heart-fill"></i>
                                            <span class="dato-label">Clasificación de Triglicéridos:</span>
                                            <span class="dato-value" id="modal-clasificaciontrigli">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-heart-pulse"></i>
                                            <span class="dato-label">Tensión Arterial:</span>
                                            <span class="dato-value" id="modal-tensionarterial">-</span>
                                        </div>
                                        <div class="dato-item">
                                            <i class="bi bi-person-hearts"></i>
                                            <span class="dato-label">Clasificación de T.A:</span>
                                            <span class="dato-value" id="modal-clasificacionta">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            if (!matricula) {
                alert("No se proporcionó una matrícula.");
                return;
            }

            // Actualizar enlaces del sidebar
            const linkPerfil = document.getElementById("linkPerfil");
            const linkDass = document.getElementById("linkDass");
            const linkEstilo = document.getElementById("linkEstilo");
            const linkHistorial = document.getElementById("linkHistorial");

            if (linkPerfil) linkPerfil.href = `expediente.html?matricula_alum=${matricula}`;
            if (linkDass) linkDass.href = `formulariodass.html?matricula_alum=${matricula}`;
            if (linkEstilo) linkEstilo.href = `formularioestilo.html?matricula_alum=${matricula}`;
            if (linkHistorial) linkHistorial.href = `HistorialPatologicoAlum.html?matricula_alum=${matricula}`;

            // Cargar perfil del alumno
            cargarPerfil();
            cargarDatosFisicosRecientes(matricula);
        });

        function cargarPerfil() {
            const params = new URLSearchParams(window.location.search);
            const matricula = params.get("matricula_alum");

            fetch(`perfil.php?matricula_alum=${matricula}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }

                    document.getElementById("matricula").value = data.matricula_alum;
                    document.getElementById("nombre").value = `${data.nombres_alum} ${data.ape_paterno_alum} ${data.ape_materno_alum}`;
                    document.getElementById("sexo").value = data.sexo;
                    document.getElementById("edad").value = data.edad_alum;
                    document.getElementById("facultad").value = data.nombre_facultad;
                    document.getElementById("carrera").value = data.nombre_carrera;
                    document.getElementById("email").value = data.correo_alum;
                })
                .catch(error => console.error("Error al cargar el perfil:", error));
        }

        function cargarDatosFisicosRecientes(matricula) {
            fetch(`perfil.php?matricula_alum=${matricula}`)
                .then(response => response.json())
                .then(data => {
                    if (data.fechas && data.fechas.length > 0) {
                        const ultimaFecha = data.fechas[data.fechas.length - 1];
                        document.getElementById("fecha-datos-fisicos").textContent = ultimaFecha;

                        fetch(`datos_fisicos_detalle.php?matricula_alum=${matricula}&fecha=${ultimaFecha}`)
                            .then(response => response.json())
                            .then(datos => {
                                // Cintura/Cadera
                                document.getElementById("modal-cintura").textContent = datos.cintura || "-";
                                document.getElementById("modal-cadera").textContent = datos.cadera || "-";
                                document.getElementById("modal-clacin").textContent = datos.clasificacion_cintura_cadera || "-";
                                document.getElementById("modal-icc").textContent = datos.icc || "-";
                                document.getElementById("modal-clasicc").textContent = datos.clasificacion_de_icc || "-";

                                // Peso y Talla
                                document.getElementById("peso").textContent = datos.peso || "-";
                                document.getElementById("modal-talla").textContent = datos.talla || "-";
                                document.getElementById("modal-imc").textContent = datos.imc || "-";
                                document.getElementById("modal-clasificacionimc").textContent = datos.clasificacion_imc || "-";
                                document.getElementById("modal-ice").textContent = datos.ice || "-";

                                // Masa Grasa
                                document.getElementById("modal-mb").textContent = datos.mb || "-";
                                document.getElementById("modal-acti").textContent = datos.actividad1 || "-";
                                document.getElementById("modal-get").textContent = datos.get1 || "-";
                                document.getElementById("modal-pormasagrasa").textContent = datos.porcentaje_masa_grasa || "-";
                                document.getElementById("modal-ideal").textContent = datos.valor_ideal_porcentaje_grasa || "-";
                                document.getElementById("modal-clasificaciongrasa").textContent = datos.clasificacion_porcentaje_grasa || "-";

                                // Masa Magra y Agua
                                document.getElementById("modal-masamagra").textContent = datos.masa_magra || "-";
                                document.getElementById("modal-aguatotal").textContent = datos.agua_total || "-";
                                document.getElementById("modal-porcentajeagua").textContent = datos.porcentaje_agua_total || "-";

                                // Glucosa y Colesterol
                                document.getElementById("modal-glucosa").textContent = datos.glucosa || "-";
                                document.getElementById("modal-clasificacionglucosa").textContent = datos.clasificacion_glucosa || "-";
                                document.getElementById("modal-colesterol").textContent = datos.colesterol || "-";
                                document.getElementById("modal-clasificacioncolesterol").textContent = datos.clasificacion_colesterol || "-";

                                // Triglicéridos y Tensión Arterial
                                document.getElementById("modal-trigliceridos").textContent = datos.trigliceridos || "-";
                                document.getElementById("modal-clasificaciontrigli").textContent = datos.clasificacion_trigliceridos || "-";
                                document.getElementById("modal-tensionarterial").textContent = datos.tension_arterial || "-";
                                document.getElementById("modal-clasificacionta").textContent = datos.clasificacion_tension_arterial || "-";
                            })
                            .catch(error => console.error("Error al cargar los datos físicos:", error));
                    } else {
                        document.getElementById("fecha-datos-fisicos").textContent = "Sin datos";
                    }
                })
                .catch(error => console.error("Error al cargar fechas:", error));
        }
    </script>

</body>

</html>